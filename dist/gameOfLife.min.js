"use strict";var GameOfLife=function(o){function t(t){for(var n=0,r=new Array(t.nRow),l=0;l<t.nRow;l++)r[l]=M[l].slice();t.clearGrid(),o.cycleColors&&e(),b.beginPath();for(var l=0;l<t.nRow;l++)for(var i=0;i<t.nCol;i++)if(r[l][i]){var s=a(r[l][i]);c(r[l][i])?2!==s&&3!==s?h(l,i):(t.setCellColorAt(l,i,A),n++):3===s&&(f(l,i),t.setCellColorAt(l,i,A),n++)}u(n,L,o.maxCircleRadius||Math.floor(.2*t.nRow)),b.fill()}function n(){y&&window.clearInterval(y),s(o.ratioAlive),y=setInterval(function(){t(m)},100)}function e(){A=r(p++,1,1),p>360&&(p=0)}function r(o,t,n){var e=0,r=0,a=0,i=o/60,c=Math.floor(i),f=i-c,h=n*(1-t),s=n*(1-t*f),u=n*(1-t*(1-f));switch(c){case 0:e=n,r=u,a=h;break;case 1:e=s,r=n,a=h;break;case 2:e=h,r=n,a=u;break;case 3:e=h,r=s,a=n;break;case 4:e=u,r=h,a=n;break;case 5:e=n,r=h,a=s;break;case 6:e=n,r=u,a=h;break;case-1:e=n,r=h,a=s;break;default:e=r=a=n}return"rgb("+Math.floor(l(255*e,0,255))+", "+Math.floor(l(255*r,0,255))+", "+Math.floor(l(255*a,0,255))+")"}function l(o,t,n){return o>n?n:t>o?t:o}function a(o){return(14&o)>>1}function i(o,t,n,e){M[o][t]=241&n|e<<1}function c(o){return 1===(1&o)}function f(o,t){if(!c(M[o][t])){M[o][t]=1|M[o][t];for(var n in v)if(v.hasOwnProperty(n)){var e=d(v[n],o,t),r=M[e[0]][e[1]],l=a(r)+1;i(e[0],e[1],r,l)}}}function h(o,t){if(c(M[o][t])){M[o][t]=254&M[o][t];for(var n in v)if(v.hasOwnProperty(n)){var e=d(v[n],o,t),r=M[e[0]][e[1]],l=a(r)-1;i(e[0],e[1],r,l)}}}function s(o){for(var t=Math.floor(m.nRow*m.nCol*o),n=0;t>n;){var e=Math.floor(Math.random()*m.nRow),r=Math.floor(Math.random()*m.nCol);c(M[e][r])||(f(e,r),n++)}}function u(o,t,n){var e,r,l;o>0&&t>o&&(l=Math.floor(Math.random()*n+1),e=Math.floor(Math.random()*(m.nRow-1)+1),r=Math.floor(Math.random()*(m.nCol-1)+1),w(e,r,l),w(e,r,l+2))}function w(o,t,n){for(var e=null,r=n,l=0,a=1-r;r>=l;)e=C(r+o,l+t),m.setCellColorAt(e[0],e[1],A),f(e[0],e[1]),e=C(-l+o,r+t),m.setCellColorAt(e[0],e[1],A),f(e[0],e[1]),e=C(-r+o,-l+t),m.setCellColorAt(e[0],e[1],A),f(e[0],e[1]),e=C(-l+o,-r+t),m.setCellColorAt(e[0],e[1],A),f(e[0],e[1]),e=C(r+o,-l+t),m.setCellColorAt(e[0],e[1],A),f(e[0],e[1]),e=C(l+o,-r+t),m.setCellColorAt(e[0],e[1],A),f(e[0],e[1]),l++,0>a?a+=2*l+1:(r--,a+=2*(l-r+1))}function C(o,t){return o%=m.nRow,o=0>o?o+m.nRow:o,t%=m.nCol,t=0>t?t+m.nCol:t,[o,t]}function d(o,t,n){switch(o){case v.TopLeft:t-=1,n-=1;break;case v.Top:t-=1;break;case v.TopRight:t-=1,n+=1;break;case v.Right:n+=1;break;case v.BottomRight:t+=1,n+=1;break;case v.Bottom:t+=1;break;case v.BottomLeft:t+=1,n-=1;break;case v.Left:n-=1;break;default:throw"Unknown position"}return t=t>-1?t<m.nRow?t:t-m.nRow:m.nRow-1,n=n>-1?n<m.nCol?n:n-m.nCol:m.nCol-1,[t,n]}const v={TopLeft:0,Top:1,TopRight:2,Right:3,BottomRight:4,Bottom:5,BottomLeft:6,Left:7};var R=function(o,t,n){var e={},r=function(o,t){return(t-t%o)/o};e.setCellColorAt=function(o,n,r){t.fillStyle=r,t.rect(n*e.cellWidth,o*e.cellHeight,e.cellWidth,e.cellHeight)},e.clearGrid=function(){t.clearRect(0,0,o.width,o.height)},e.nCol=r(n,o.width),e.nRow=r(n,o.height);var l=o.width-e.nCol*n,a=o.height-e.nRow*n;return e.cellWidth=l/e.nCol+n,e.cellHeight=a/e.nRow+n,e},g=document.getElementById(o.canvasId),b=g.getContext("2d");if(!g)throw"Canvas not found for given ID: "+o.canvasId;var k={},m=null,M=[],A=null,p=0,y=null,L=0,B=function(){g.width=g.parentElement.clientWidth,g.height=g.parentElement.clientHeight,m=new R(g,b,o.cellSize),L=Math.floor(m.nRow*m.nCol*o.ratioAlive*o.circleDropThreshold),o.cycleColors||(A=o.color),M=new Array(m.nRow);for(var t=0;t<m.nRow;t++)M[t]=new Array(m.nCol);n()};return k.run=function(){window.addEventListener("resize",B,!1),B()},k};